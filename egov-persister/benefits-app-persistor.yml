serviceMaps:
  serviceName: universal-benefits-application
  mappings:
    - version: 1.0
      description: Persists benefit application details in tables
      fromTopic: ubp-application-create
      isTransaction: true
      queryMaps:
        - query: INSERT INTO eg_ubp_application (id, tenant_id, application_number, individual_id, program_code, status, wf_status, additional_details, created_by, last_modified_by, created_time, last_modified_time) VALUES (?, ?, ?, ?, ?, ?, ?,  CAST(? AS JSONB), ?, ?, ?, ?)
          basePath: Application
          jsonMaps:
            - jsonPath: $.Application.id

            - jsonPath: $.Application.tenantId

            - jsonPath: $.Application.applicationNumber

            - jsonPath: $.Application.individualId

            - jsonPath: $.Application.programCode

            - jsonPath: $.Application.status

            - jsonPath: $.Application.wfStatus

            - jsonPath: $.Application.additionalDetails

            - jsonPath: $.Application.auditDetails.createdBy

            - jsonPath: $.Application.auditDetails.lastModifiedBy

            - jsonPath: $.Application.auditDetails.createdTime

            - jsonPath: $.Application.auditDetails.lastModifiedTime

        - query: INSERT INTO eg_ubp_applicant(id,application_id,student_name,father_name,samagra_id,school_name,school_address,school_address_district,current_class,previous_year_marks,student_type,aadhar_last_4_digits,caste, income, gender, age, disability) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
          basePath: Application
          jsonMaps:
            - jsonPath: $.Application.applicant.id

            - jsonPath: $.Application.id

            - jsonPath: $.Application.applicant.studentName

            - jsonPath: $.Application.applicant.fatherName

            - jsonPath: $.Application.applicant.samagraId

            - jsonPath: $.Application.applicant.currentSchoolName

            - jsonPath: $.Application.applicant.currentSchoolAddress

            - jsonPath: $.Application.applicant.currentSchoolAddressDistrict

            - jsonPath: $.Application.applicant.currentClass

            - jsonPath: $.Application.applicant.previousYearMarks

            - jsonPath: $.Application.applicant.studentType

            - jsonPath: $.Application.applicant.aadharLast4Digits

            - jsonPath: $.Application.applicant.caste

            - jsonPath: $.Application.applicant.income

            - jsonPath: $.Application.applicant.gender

            - jsonPath: $.Application.applicant.age

            - jsonPath: $.Application.applicant.disability

        - query: INSERT INTO eg_ubp_application_documents(id, filestore_id, document_type, document_uid, status, application_id, additional_details, created_by, last_modified_by, created_time, last_modified_time) VALUES (?, ?, ?, ?, ?, ?, CAST(? AS JSONB), ?, ?, ?, ?)
          basePath: Application.documents.*
          jsonMaps:
            - jsonPath: $.Application.documents.*.id

            - jsonPath: $.Application.documents.*.fileStoreId

            - jsonPath: $.Application.documents.*.documentType

            - jsonPath: $.Application.documents.*.documentUid

            - jsonPath: $.Application.documents.*.status

            - jsonPath: $.Application.id

            - jsonPath: $.Application.documents.*.additionalDetails

            - jsonPath: $.Application.auditDetails.createdBy

            - jsonPath: $.Application.auditDetails.lastModifiedBy

            - jsonPath: $.Application.auditDetails.createdTime

            - jsonPath: $.Application.auditDetails.lastModifiedTime